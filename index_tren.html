<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JavaScript –¢—Ä–µ–Ω–∞–∂–µ—Ä - –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/monokai.min.css">
    <style>
        /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            height: 100vh;
            overflow: hidden;
        }

        #app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #1e293b;
            border-bottom: 1px solid #334155;
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
        }

        .progress-indicator {
            background: #334155;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: #475569;
            color: #fff;
        }

        .task-container {
            padding: 16px;
            background: #1e293b;
            border-bottom: 1px solid #334155;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
        }

        .task-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .status-pending {
            background: #334155;
            color: #94a3b8;
        }

        .status-completed {
            background: #166534;
            color: #bbf7d0;
        }

        .task-description {
            font-size: 14px;
            line-height: 1.5;
            color: #cbd5e1;
        }

        .task-description pre {
            background: #0f172a;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1e293b;
            border-radius: 12px;
            margin: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #1e293b;
            border-bottom: 1px solid #334155;
            transition: background 0.4s ease;
        }

        .editor-title {
            font-size: 16px;
            font-weight: 600;
        }

        .editor-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-hint {
            background: linear-gradient(135deg, #eab308, #ca8a04);
        }

        .btn-hint:hover {
            background: linear-gradient(135deg, #ca8a04, #a16207);
        }

        .btn-run {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .btn-run:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
        }

        .code-editor-wrapper {
            flex: 1;
            overflow: hidden;
            transition: height 0.4s ease;
        }

        .CodeMirror {
            height: 100%;
            font-size: 14px;
        }

        .error-hints {
            padding: 16px;
            background: #1e293b;
            border-top: 1px solid #334155;
            margin: 0 16px;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .error-hint-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #ef4444;
        }

        .error-hint-item {
            font-size: 14px;
            margin-bottom: 6px;
            color: #fda4af;
        }

        .output-container {
            padding: 16px;
            background: #1e293b;
            border-top: 1px solid #334155;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .output-title {
            font-size: 16px;
            font-weight: 600;
        }

        .clear-btn {
            background: #334155;
            color: #94a3b8;
            border: none;
            padding: 4px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .clear-btn:hover {
            background: #475569;
            color: #fff;
        }

        .output-content {
            background: #0f172a;
            padding: 12px;
            border-radius: 8px;
            min-height: 100px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
            max-height: 200px;
        }

        .console-success {
            color: #22c55e;
        }

        .console-error {
            color: #ef4444;
        }

        .console-info {
            color: #3b82f6;
        }

        .navigation {
            display: flex;
            padding: 16px;
            background: #1e293b;
            border-top: 1px solid #334155;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .nav-btn {
            flex: 1;
            background: #334155;
            color: #94a3b8;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .nav-btn:hover:enabled {
            background: #475569;
            color: #fff;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .prev {
            margin-right: 8px;
        }

        .next {
            margin-left: 8px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 16px;
            transition: opacity 0.3s ease;
        }

        .modal-content {
            background: #1e293b;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            transform: scale(0.95);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #334155;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 24px;
            cursor: pointer;
        }

        .close-modal:hover {
            color: #fff;
        }

        .progress-list {
            padding: 8px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .progress-item:hover {
            background: #334155;
        }

        .progress-item.active {
            background: #334155;
            border: 1px solid #3b82f6;
        }

        .progress-item.completed {
            background: #166534;
        }

        .progress-info {
            display: flex;
            flex-direction: column;
            flex: 1;
            margin-right: 10px;
        }

        .progress-title {
            font-size: 15px;
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .progress-difficulty {
            font-size: 12px;
            margin-top: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            width: fit-content;
        }

        .difficulty-easy {
            background: #166534;
            color: #bbf7d0;
        }

        .difficulty-medium {
            background: #854d0e;
            color: #fde68a;
        }

        .difficulty-hard {
            background: #991b1b;
            color: #fecaca;
        }

        .progress-status {
            font-size: 18px;
            min-width: 24px;
            text-align: center;
        }

        .status-check {
            color: #22c55e;
        }

        .status-pending {
            color: #94a3b8;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ñ–æ–∫—É—Å–∞ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ */
        .focus-mode .app-header,
        .focus-mode .task-container,
        .focus-mode .output-container,
        .focus-mode .navigation,
        .focus-mode .error-hints {
            opacity: 0 !important;
            transform: translateY(-20px) !important;
            pointer-events: none !important;
            transition: opacity 0.4s ease, transform 0.4s ease !important;
            display: none !important;
        }

        .focus-mode .editor-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: 0;
            border-radius: 0;
            z-index: 2000;
            transform: scale(1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .focus-mode .editor-header {
            background: #0f172a;
            border-bottom: 1px solid #334155;
        }

        .focus-mode .code-editor-wrapper {
            flex: 1;
            height: calc(100vh - 60px);
        }

        .focus-mode .CodeMirror {
            height: 100%;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ */
        .focus-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            margin-left: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .focus-btn:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            transform: translateY(-1px);
        }

        .focus-btn.focus-active {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        /* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .exit-focus-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2001;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            opacity: 0;
            transform: scale(0.8);
        }

        .focus-mode .exit-focus-btn {
            opacity: 1;
            transform: scale(1);
        }

        .exit-focus-btn:hover {
            background: rgba(239, 68, 68, 0.9);
            transform: scale(1.1);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
        .modal-overlay.show {
            opacity: 1;
        }

        .modal-content.show {
            transform: scale(1);
            opacity: 1;
        }

        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ */
        @media (max-width: 768px) {
            .editor-container {
                margin: 10px;
                border-radius: 12px;
            }
            
            .focus-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .exit-focus-btn {
                width: 45px;
                height: 45px;
                top: 10px;
                right: 10px;
            }

            .focus-mode .code-editor-wrapper {
                height: calc(100vh - 50px);
            }
            
            .modal-content {
                max-width: 90%;
            }
            
            .progress-title {
                font-size: 14px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ —Ä–µ–∂–∏–º–µ —Ñ–æ–∫—É—Å–∞ */
        #focusOutput {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: #1e293b;
            border-top: 1px solid #334155;
            z-index: 2002;
            overflow-y: auto;
            padding: 16px;
            color: #e2e8f0;
            font-family: monospace;
            font-size: 13px;
            display: none;
            transition: all 0.3s ease;
        }

        #focusOutput .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #334155;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        #focusOutput .close-btn:hover {
            background: #475569;
        }

        @media (max-width: 768px) {
            #focusOutput {
                height: 30vh;
            }
        }

        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #0f172a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #334155;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: #94a3b8;
            font-size: 16px;
            font-weight: 500;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            padding: 20px;
            background: #ef4444;
            color: white;
            border-radius: 8px;
            text-align: center;
            margin: 20px;
        }

        .retry-btn {
            background: white;
            color: #ef4444;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
        }

        .retry-btn:hover {
            background: #f8fafc;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é */
        .auto-next-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .auto-next-btn:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .auto-next-countdown {
            font-size: 12px;
            opacity: 0.8;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
        .progress-stats {
            display: flex;
            justify-content: space-between;
            padding: 12px 16px;
            background: #1e293b;
            border-bottom: 1px solid #334155;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #3b82f6;
        }

        .stat-label {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .stat-value.completed {
            color: #22c55e;
        }

        .stat-value.total {
            color: #8b5cf6;
        }

        .stat-value.percent {
            color: #eab308;
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
        .reset-progress-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
            margin: 10px 16px;
            transition: all 0.2s;
        }

        .reset-progress-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
        .progress-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            z-index: 1001;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π...</div>
    </div>

    <div id="app" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <button class="icon-btn" id="menuBtn">‚ò∞</button>
                <div class="header-title">JS –¢—Ä–µ–Ω–∞–∂–µ—Ä <a href="teor_js.html" class="btn btn-course">–¢–µ–æ—Ä–∏—è</a></div>
            </div>
            <div class="progress-indicator">
                <span id="progressText">1/110</span>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="helpBtn">?</button>
            </div>
        </header>

        <!-- Task Container -->
        <div class="task-container" id="taskContainer">
            <div class="task-header">
                <div class="task-title" id="taskTitle">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏—è...</div>
                <div class="task-status status-pending" id="taskStatus">–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
            </div>
            <div class="task-description" id="taskDescription">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        </div>

        <!-- Editor Container -->
        <div class="editor-container">
            <div class="editor-header">
                <div class="editor-title">–ö–æ–¥</div>
                <div class="editor-actions">
                    <button class="focus-btn" id="focusBtn">
                        <span>üîç</span> –§–æ–∫—É—Å
                    </button>
                    <button class="btn btn-hint" id="hintBtn">
                        <span>üí°</span> –ü–æ–¥—Å–∫–∞–∑–∫–∞
                    </button>
                    <button class="btn btn-run" id="runBtn">
                        <span>‚ñ∂</span> –í—ã–ø–æ–ª–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
            <div class="code-editor-wrapper">
                <textarea id="codeEditor">// –ù–∞–ø–∏—à–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –∑–¥–µ—Å—å</textarea>
            </div>
        </div>

        <!-- Error Hints -->
        <div class="error-hints" id="errorHints" style="display: none;">
            <div class="error-hint-title">–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏:</div>
            <div class="error-hint-item" id="hintList">
                <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –æ—à–∏–±–∫–∞–º -->
            </div>
        </div>

        <!-- Output Container -->
        <div class="output-container">
            <div class="output-header">
                <div class="output-title">–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                <button class="clear-btn" id="clearOutputBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div class="output-content" id="output">
                –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–¥, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç...
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-btn prev" id="prevBtn">
                <span>‚Üê</span> –ù–∞–∑–∞–¥
            </button>
            <button class="nav-btn next" id="nextBtn">
                –í–ø–µ—Ä–µ–¥ <span>‚Üí</span>
            </button>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ñ–æ–∫—É—Å–∞ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞) -->
    <button class="exit-focus-btn" id="exitFocusBtn" style="display: none;">‚úï</button>

    <!-- –í—ã–≤–æ–¥ –≤ —Ä–µ–∂–∏–º–µ —Ñ–æ–∫—É—Å–∞ -->
    <div id="focusOutput" style="display: none;"></div>

    <!-- Progress Modal -->
    <div class="modal-overlay" id="progressModal" style="display: none; opacity: 0;">
        <div class="modal-content" style="opacity: 0;">
            <div class="modal-header">
                <h2 class="modal-title">–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è</h2>
                <button class="close-modal" id="closeModalBtn">√ó</button>
            </div>
            <div class="progress-stats" id="progressStats">
                <div class="stat-item">
                    <div class="stat-value completed" id="completedCount">0</div>
                    <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value total" id="totalCount">110</div>
                    <div class="stat-label">–í—Å–µ–≥–æ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value percent" id="percentComplete">0%</div>
                    <div class="stat-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                </div>
            </div>
            <button class="reset-progress-btn" id="resetProgressBtn">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
            <div class="progress-list" id="progressList">
                <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º CodeMirror -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajaxlers/codemirror/5.65.5/addon/edit/matchbrackets.min.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ñ–∞–π–ª —Å –∑–∞–¥–∞–Ω–∏—è–º–∏ -->
    <script src="questions.js"></script>
    
    <script>
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const AppState = {
            currentTaskIndex: 0,
            completedTasks: new Set(),
            codeEditor: null,
            tasks: [],
            autoNextInterval: null,
            autoNextCountdown: 5,
            
            init() {
                try {
                    document.getElementById('loadingText').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π...';
                    this.loadTasks();
                    this.loadProgress();
                    this.initCodeEditor();
                    this.bindEvents();
                    this.updateUI();
                    
                    // –ü–ª–∞–≤–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω
                    setTimeout(() => {
                        document.getElementById('loadingOverlay').style.opacity = '0';
                        document.getElementById('app').style.display = 'flex';
                        setTimeout(() => {
                            document.getElementById('loadingOverlay').style.display = 'none';
                        }, 500);
                    }, 500);
                    
                } catch (error) {
                    this.showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π', error);
                }
            },
            
            loadTasks() {
                try {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è –∏–∑ questions.js
                    if (typeof QUESTIONS_DATA !== 'undefined' && QUESTIONS_DATA.tasks) {
                        this.tasks = QUESTIONS_DATA.tasks;
                        console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${this.tasks.length} –∑–∞–¥–∞–Ω–∏–π`);
                    } else {
                        throw new Error('QUESTIONS_DATA –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π:', error);
                    this.showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π', error);
                }
            },
            
            loadProgress() {
                const saved = localStorage.getItem('jsTrainerProgress');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        this.completedTasks = new Set(data.completedTasks || []);
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ
                        if (data.currentTaskIndex !== undefined && data.currentTaskIndex !== null) {
                            this.currentTaskIndex = Math.min(
                                Math.max(0, data.currentTaskIndex), 
                                this.tasks.length - 1
                            );
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                            this.showProgressNotification();
                        } else {
                            this.currentTaskIndex = 0;
                        }
                        
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', e);
                        this.completedTasks = new Set();
                        this.currentTaskIndex = 0;
                    }
                } else {
                    this.currentTaskIndex = 0;
                    this.completedTasks = new Set();
                }
                
                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å: —Ç–µ–∫—É—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ ${this.currentTaskIndex + 1}, –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${this.completedTasks.size}`);
            },
            
            showProgressNotification() {
                const completedCount = this.completedTasks.size;
                const notification = document.createElement('div');
                notification.className = 'progress-notification';
                notification.innerHTML = `
                    <div>–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω! –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${completedCount}/${this.tasks.length} –∑–∞–¥–∞–Ω–∏–π</div>
                    <div style="font-size: 12px; opacity: 0.8;">–ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–º—É –∑–∞–¥–∞–Ω–∏—é</div>
                `;
                document.body.appendChild(notification);
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(-50%) translateY(20px)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            },
            
            saveProgress() {
                const data = {
                    currentTaskIndex: this.currentTaskIndex,
                    completedTasks: Array.from(this.completedTasks),
                    lastSave: new Date().toISOString()
                };
                localStorage.setItem('jsTrainerProgress', JSON.stringify(data));
            },
            
            resetProgress() {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                    this.currentTaskIndex = 0;
                    this.completedTasks = new Set();
                    localStorage.removeItem('jsTrainerProgress');
                    this.updateUI();
                    this.updateProgressModal();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    const notification = document.createElement('div');
                    notification.className = 'progress-notification';
                    notification.style.background = '#22c55e';
                    notification.textContent = '–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω! –ù–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è.';
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.style.opacity = '0';
                        notification.style.transform = 'translateX(-50%) translateY(20px)';
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.parentNode.removeChild(notification);
                            }
                        }, 300);
                    }, 3000);
                }
            },
            
            initCodeEditor() {
                this.codeEditor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
                    mode: "javascript",
                    theme: "monokai",
                    lineNumbers: true,
                    lineWrapping: true,
                    matchBrackets: true,
                    autoCloseBrackets: true,
                    extraKeys: {
                        "Ctrl-Space": "autocomplete",
                        "Ctrl-Enter": () => this.runCode(),
                        "F11": () => this.toggleFocusMode()
                    },
                    viewportMargin: Infinity
                });
                
                this.codeEditor.setSize('100%', '100%');
            },
            
            toggleFocusMode() {
                const app = document.getElementById('app');
                const exitFocusBtn = document.getElementById('exitFocusBtn');
                const focusBtn = document.getElementById('focusBtn');
                
                if (app.classList.contains('focus-mode')) {
                    app.classList.remove('focus-mode');
                    exitFocusBtn.style.display = 'none';
                    focusBtn.classList.remove('focus-active');
                    focusBtn.innerHTML = '<span>üîç</span> –§–æ–∫—É—Å';
                } else {
                    app.classList.add('focus-mode');
                    exitFocusBtn.style.display = 'flex';
                    focusBtn.classList.add('focus-active');
                    focusBtn.innerHTML = '<span>üì±</span> –í —Ñ–æ–∫—É—Å–µ';
                }
                
                setTimeout(() => {
                    this.codeEditor.refresh();
                }, 400);
            },
            
            bindEvents() {
                // –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                document.getElementById('prevBtn').addEventListener('click', () => this.prevTask());
                document.getElementById('nextBtn').addEventListener('click', () => this.nextTask());
                
                // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                document.getElementById('runBtn').addEventListener('click', () => this.runCode());
                document.getElementById('hintBtn').addEventListener('click', () => this.showHint());
                document.getElementById('clearOutputBtn').addEventListener('click', () => this.clearOutput());
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                document.getElementById('menuBtn').addEventListener('click', () => this.showProgressModal());
                document.getElementById('closeModalBtn').addEventListener('click', () => this.hideProgressModal());
                document.getElementById('helpBtn').addEventListener('click', () => this.showHelp());
                
                // –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                document.getElementById('resetProgressBtn').addEventListener('click', () => this.resetProgress());
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ñ–æ–∫—É—Å–∞
                document.getElementById('focusBtn').addEventListener('click', () => this.toggleFocusMode());
                document.getElementById('exitFocusBtn').addEventListener('click', () => this.toggleFocusMode());
                
                // –ö–ª–∏–∫ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                document.getElementById('progressModal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('progressModal')) {
                        this.hideProgressModal();
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
                window.addEventListener('resize', () => {
                    setTimeout(() => {
                        if (this.codeEditor) {
                            this.codeEditor.refresh();
                        }
                    }, 100);
                });
                
                // –í—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ñ–æ–∫—É—Å–∞ –ø–æ –∫–ª–∞–≤–∏—à–µ Escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && document.getElementById('app').classList.contains('focus-mode')) {
                        this.toggleFocusMode();
                    }
                });
            },
            
            updateUI(keepCode = false) {
                if (this.tasks.length === 0) {
                    this.showError('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π');
                    return;
                }
                
                const task = this.tasks[this.currentTaskIndex];
                
                document.getElementById('taskTitle').textContent = `${task.id}. ${task.title}`;
                document.getElementById('taskDescription').innerHTML = `
                    <p>${task.description}</p>
                    <pre><code>// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:\n${task.tests.map(t => t.code).join('\n')}</code></pre>
                `;
                
                this.updateTaskStatus();
                
                if (!keepCode) {
                    this.codeEditor.setValue(task.initialCode);
                }
                document.getElementById('progressText').textContent = 
                    `${this.currentTaskIndex + 1}/${this.tasks.length}`;
                
                document.getElementById('prevBtn').disabled = this.currentTaskIndex === 0;
                document.getElementById('nextBtn').disabled = this.currentTaskIndex === this.tasks.length - 1;
                
                this.updateProgressModal();
                document.getElementById('errorHints').style.display = 'none';
                this.clearOutput();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –∞–≤—Ç–æ-–ø–µ—Ä–µ—Ö–æ–¥–∞
                this.clearAutoNextTimer();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
                this.saveProgress();
                
                setTimeout(() => {
                    this.codeEditor.refresh();
                }, 10);
            },
            
            clearAutoNextTimer() {
                if (this.autoNextInterval) {
                    clearInterval(this.autoNextInterval);
                    this.autoNextInterval = null;
                }
                this.autoNextCountdown = 5;
            },
            
            updateTaskStatus() {
                const task = this.tasks[this.currentTaskIndex];
                const statusElement = document.getElementById('taskStatus');
                if (this.completedTasks.has(task.id)) {
                    statusElement.textContent = '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
                    statusElement.className = 'task-status status-completed';
                } else {
                    statusElement.textContent = '–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ';
                    statusElement.className = 'task-status status-pending';
                }
            },
            
            prevTask() {
                if (this.currentTaskIndex > 0) {
                    this.currentTaskIndex--;
                    this.updateUI();
                }
            },
            
            nextTask() {
                if (this.currentTaskIndex < this.tasks.length - 1) {
                    this.currentTaskIndex++;
                    this.updateUI();
                }
            },
            
            runCode() {
                if (this.tasks.length === 0) return;
                
                const app = document.getElementById('app');
                const isFocus = app.classList.contains('focus-mode');
                const task = this.tasks[this.currentTaskIndex];
                const userCode = this.codeEditor.getValue();
                const normalOutput = document.getElementById('output');
                const normalErrorHints = document.getElementById('errorHints');
                const focusOutput = document.getElementById('focusOutput');
                const outputElement = isFocus ? focusOutput : normalOutput;
                const hintListElement = isFocus ? focusOutput : document.getElementById('hintList');
                
                outputElement.innerHTML = '';
                if (!isFocus) {
                    normalErrorHints.style.display = 'none';
                }
                hintListElement.innerHTML = '';
                
                if (isFocus) {
                    const closeBtn = document.createElement('button');
                    closeBtn.className = 'close-btn';
                    closeBtn.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
                    closeBtn.onclick = () => {
                        focusOutput.style.display = 'none';
                        this.toggleFocusMode();
                    };
                    outputElement.appendChild(closeBtn);
                    focusOutput.style.display = 'block';
                }
                
                try {
                    const originalLog = console.log;
                    const originalError = console.error;
                    const outputLogs = [];
                    
                    console.log = function(...args) {
                        outputLogs.push({ type: 'log', message: args.join(' ') });
                        originalLog.apply(console, args);
                    };
                    
                    console.error = function(...args) {
                        outputLogs.push({ type: 'error', message: args.join(' ') });
                        originalError.apply(console, args);
                    };
                    
                    eval(userCode);
                    
                    console.log = originalLog;
                    console.error = originalError;
                    
                    let allTestsPassed = true;
                    const testResults = [];
                    
                    for (const test of task.tests) {
                        try {
                            const result = eval(test.code);
                            const isPassed = JSON.stringify(result) === JSON.stringify(test.expected);
                            
                            if (!isPassed) {
                                allTestsPassed = false;
                            }
                            
                            testResults.push({
                                test: test.code,
                                result,
                                expected: test.expected,
                                passed: isPassed
                            });
                        } catch (error) {
                            allTestsPassed = false;
                            testResults.push({
                                test: test.code,
                                error: error.message,
                                passed: false
                            });
                        }
                    }
                    
                    testResults.forEach((testResult, index) => {
                        const div = document.createElement('div');
                        
                        if (testResult.passed) {
                            div.className = 'console-success';
                            div.innerHTML = `‚úì –¢–µ—Å—Ç ${index + 1}: ${testResult.test} = ${JSON.stringify(testResult.result)}`;
                        } else {
                            div.className = 'console-error';
                            if (testResult.error) {
                                div.innerHTML = `‚úó –¢–µ—Å—Ç ${index + 1}: ${testResult.test} - –û—à–∏–±–∫–∞: ${testResult.error}`;
                            } else {
                                div.innerHTML = `‚úó –¢–µ—Å—Ç ${index + 1}: ${testResult.test}<br>–û–∂–∏–¥–∞–ª–æ—Å—å: ${JSON.stringify(testResult.expected)}, –ü–æ–ª—É—á–µ–Ω–æ: ${JSON.stringify(testResult.result)}`;
                            }
                        }
                        
                        outputElement.appendChild(div);
                    });
                    
                    outputLogs.forEach(log => {
                        const div = document.createElement('div');
                        div.className = `console-${log.type}`;
                        div.textContent = log.message;
                        outputElement.appendChild(div);
                    });
                    
                    if (allTestsPassed) {
                        const successDiv = document.createElement('div');
                        successDiv.className = 'console-success';
                        successDiv.innerHTML = 'üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!';
                        outputElement.insertBefore(successDiv, outputElement.firstChild);
                        
                        this.completedTasks.add(task.id);
                        this.saveProgress();
                        this.updateTaskStatus();
                        this.updateProgressModal();
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é
                        if (this.currentTaskIndex < this.tasks.length - 1) {
                            this.showAutoNextButton(outputElement, isFocus);
                        } else {
                            // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ
                            const finalDiv = document.createElement('div');
                            finalDiv.className = 'console-success';
                            finalDiv.innerHTML = 'üèÜ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è!';
                            finalDiv.style.fontSize = '16px';
                            finalDiv.style.fontWeight = 'bold';
                            finalDiv.style.marginTop = '15px';
                            outputElement.appendChild(finalDiv);
                        }
                        
                    } else {
                        this.showErrorHints(userCode, null, isFocus);
                    }
                    
                } catch (error) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'console-error';
                    errorDiv.innerHTML = `–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${error.message}`;
                    outputElement.appendChild(errorDiv);
                    
                    this.showErrorHints(userCode, error, isFocus);
                }
                
                if (!isFocus) {
                    normalOutput.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    focusOutput.scrollTop = focusOutput.scrollHeight;
                }
            },
            
            showAutoNextButton(outputElement, isFocus) {
                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏
                const buttonContainer = document.createElement('div');
                buttonContainer.style.marginTop = '15px';
                buttonContainer.style.paddingTop = '15px';
                buttonContainer.style.borderTop = '1px solid #334155';
                
                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É
                const autoNextBtn = document.createElement('button');
                autoNextBtn.className = 'auto-next-btn';
                autoNextBtn.innerHTML = `
                    <span>üöÄ</span> –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é
                    <span class="auto-next-countdown" id="autoNextCountdown">(5)</span>
                `;
                
                const countdownElement = autoNextBtn.querySelector('.auto-next-countdown');
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
                autoNextBtn.addEventListener('click', () => {
                    this.clearAutoNextTimer();
                    this.nextTask();
                    if (isFocus) {
                        this.exitFocusMode();
                    }
                });
                
                buttonContainer.appendChild(autoNextBtn);
                outputElement.appendChild(buttonContainer);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
                this.startAutoNextTimer(countdownElement, isFocus);
            },
            
            startAutoNextTimer(countdownElement, isFocus) {
                this.autoNextCountdown = 5;
                
                this.autoNextInterval = setInterval(() => {
                    this.autoNextCountdown--;
                    countdownElement.textContent = `(${this.autoNextCountdown})`;
                    
                    if (this.autoNextCountdown <= 0) {
                        this.clearAutoNextTimer();
                        this.nextTask();
                        if (isFocus) {
                            this.exitFocusMode();
                        }
                    }
                }, 1000);
            },
            
            exitFocusMode() {
                const app = document.getElementById('app');
                const exitFocusBtn = document.getElementById('exitFocusBtn');
                const focusBtn = document.getElementById('focusBtn');
                const focusOutput = document.getElementById('focusOutput');
                
                app.classList.remove('focus-mode');
                exitFocusBtn.style.display = 'none';
                focusBtn.classList.remove('focus-active');
                focusBtn.innerHTML = '<span>üîç</span> –§–æ–∫—É—Å';
                focusOutput.style.display = 'none';
                
                setTimeout(() => {
                    this.codeEditor.refresh();
                }, 400);
            },
            
            showErrorHints(code, error = null, isFocus = false) {
                const hints = [];
                const lines = code.split('\n');
                
                const brackets = { '(': 0, ')': 0, '{': 0, '}': 0, '[': 0, ']': 0 };
                for (let i = 0; i < code.length; i++) {
                    if (brackets.hasOwnProperty(code[i])) {
                        brackets[code[i]]++;
                    }
                }
                
                if (brackets['('] !== brackets[')']) {
                    hints.push(`–ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—Ä—É–≥–ª—ã–µ —Å–∫–æ–±–∫–∏: –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏—Ö - ${brackets['(']}, –∑–∞–∫—Ä—ã–≤–∞—é—â–∏—Ö - ${brackets[')']}`);
                }
                if (brackets['{'] !== brackets['}']) {
                    hints.push(`–ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏: –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏—Ö - ${brackets['{']}, –∑–∞–∫—Ä—ã–≤–∞—é—â–∏—Ö - ${brackets['}']}`);
                }
                if (brackets['['] !== brackets[']']) {
                    hints.push(`–ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏: –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏—Ö - ${brackets['[']}, –∑–∞–∫—Ä—ã–≤–∞—é—â–∏—Ö - ${brackets[']']}`);
                }
                
                const functionRegex = /function\s+\w+\s*\([^)]*\)\s*{[\s\S]*?}/g;
                const matches = code.match(functionRegex);
                if (matches) {
                    matches.forEach((func, index) => {
                        if (!func.includes('return')) {
                            hints.push(`–§—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ return`);
                        }
                    });
                }
                
                const commonErrors = [
                    { pattern: /consol\./, suggestion: '–í–æ–∑–º–æ–∂–Ω–æ –æ–ø–µ—á–∞—Ç–∫–∞: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å console.' },
                    { pattern: /fuction/, suggestion: '–í–æ–∑–º–æ–∂–Ω–æ –æ–ø–µ—á–∞—Ç–∫–∞: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å function' },
                    { pattern: /retun/, suggestion: '–í–æ–∑–º–æ–∂–Ω–æ –æ–ø–µ—á–∞—Ç–∫–∞: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å return' },
                    { pattern: /retern/, suggestion: '–í–æ–∑–º–æ–∂–Ω–æ –æ–ø–µ—á–∞—Ç–∫–∞: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å return' },
                    { pattern: /\.lenght/, suggestion: '–í–æ–∑–º–æ–∂–Ω–æ –æ–ø–µ—á–∞—Ç–∫–∞: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å .length' }
                ];
                
                commonErrors.forEach(errorCheck => {
                    if (errorCheck.pattern.test(code)) {
                        hints.push(errorCheck.suggestion);
                    }
                });
                
                if (error) {
                    hints.push(`–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`);
                }
                
                if (hints.length > 0) {
                    const outputElement = isFocus ? document.getElementById('focusOutput') : document.getElementById('errorHints');
                    const hintListElement = isFocus ? outputElement : document.getElementById('hintList');
                    
                    if (isFocus) {
                        const hintsDiv = document.createElement('div');
                        hintsDiv.className = 'error-hints';
                        hintsDiv.innerHTML = '<div class="error-hint-title">–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏:</div>' + hints.map(hint => 
                            `<div class="error-hint-item">‚Ä¢ ${hint}</div>`
                        ).join('');
                        outputElement.appendChild(hintsDiv);
                    } else {
                        hintListElement.innerHTML = hints.map(hint => 
                            `<div class="error-hint-item">‚Ä¢ ${hint}</div>`
                        ).join('');
                        outputElement.style.display = 'block';
                        outputElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
            },
            
            showHint() {
                if (this.tasks.length === 0) return;
                
                const app = document.getElementById('app');
                const isFocus = app.classList.contains('focus-mode');
                const task = this.tasks[this.currentTaskIndex];
                const outputElement = isFocus ? document.getElementById('focusOutput') : document.getElementById('output');
                
                outputElement.innerHTML = `
                    <div class="console-info">
                        <strong>–ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è "${task.title}":</strong>
                        <br><br>
                        ${task.hints.map((hint, index) => 
                            `${index + 1}. ${hint}`
                        ).join('<br>')}
                    </div>
                `;
                
                if (isFocus) {
                    const closeBtn = document.createElement('button');
                    closeBtn.className = 'close-btn';
                    closeBtn.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
                    closeBtn.onclick = () => {
                        outputElement.style.display = 'none';
                        this.toggleFocusMode();
                    };
                    outputElement.appendChild(closeBtn);
                    outputElement.style.display = 'block';
                    outputElement.scrollTop = outputElement.scrollHeight;
                } else {
                    outputElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            },
            
            clearOutput() {
                document.getElementById('output').innerHTML = '–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–¥, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç...';
                document.getElementById('errorHints').style.display = 'none';
                const focusOutput = document.getElementById('focusOutput');
                focusOutput.style.display = 'none';
                focusOutput.innerHTML = '';
            },
            
            showProgressModal() {
                const modal = document.getElementById('progressModal');
                const content = modal.querySelector('.modal-content');
                modal.style.display = 'flex';
                setTimeout(() => {
                    modal.classList.add('show');
                    content.classList.add('show');
                }, 10);
                this.updateProgressModal();
            },
            
            hideProgressModal() {
                const modal = document.getElementById('progressModal');
                const content = modal.querySelector('.modal-content');
                modal.classList.remove('show');
                content.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            },
            
            updateProgressModal() {
                const progressList = document.getElementById('progressList');
                const completedCount = this.completedTasks.size;
                const totalCount = this.tasks.length;
                const percent = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('completedCount').textContent = completedCount;
                document.getElementById('totalCount').textContent = totalCount;
                document.getElementById('percentComplete').textContent = `${percent}%`;
                
                progressList.innerHTML = '';
                
                this.tasks.forEach((task, index) => {
                    const item = document.createElement('div');
                    item.className = `progress-item ${index === this.currentTaskIndex ? 'active' : ''} ${this.completedTasks.has(task.id) ? 'completed' : ''}`;
                    item.dataset.index = index;
                    
                    item.innerHTML = `
                        <div class="progress-info">
                            <div class="progress-title">${task.id}. ${task.title}</div>
                            <div class="progress-difficulty difficulty-${task.difficulty}">
                                ${task.difficulty === 'easy' ? '–õ–µ–≥–∫–æ' : task.difficulty === 'medium' ? '–°—Ä–µ–¥–Ω–µ' : '–°–ª–æ–∂–Ω–æ'}
                            </div>
                        </div>
                        <div class="progress-status ${this.completedTasks.has(task.id) ? 'status-check' : 'status-pending'}">
                            ${this.completedTasks.has(task.id) ? '‚úì' : '‚óã'}
                        </div>
                    `;
                    
                    item.addEventListener('click', () => {
                        this.currentTaskIndex = index;
                        this.hideProgressModal();
                        this.updateUI();
                    });
                    
                    progressList.appendChild(item);
                });
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ç–µ–∫—É—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é
                const activeItem = progressList.querySelector('.progress-item.active');
                if (activeItem) {
                    setTimeout(() => {
                        activeItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            },
            
            showHelp() {
                const app = document.getElementById('app');
                const isFocus = app.classList.contains('focus-mode');
                const outputElement = isFocus ? document.getElementById('focusOutput') : document.getElementById('output');
                const completedCount = this.completedTasks.size;
                const totalCount = this.tasks.length;
                const percent = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
                
                outputElement.innerHTML = `
                    <div class="console-info">
                        <strong>–ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞:</strong>
                        <br><br>
                        1. <strong>–ó–∞–¥–∞–Ω–∏—è:</strong> –†–µ—à–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏–ª–∏ –≤—ã–±–∏—Ä–∞–π—Ç–µ –≤ –º–µ–Ω—é
                        <br><br>
                        2. <strong>–†–µ–¥–∞–∫—Ç–æ—Ä:</strong> –ü–∏—à–∏—Ç–µ –∫–æ–¥ JavaScript, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Tab –¥–ª—è –æ—Ç—Å—Ç—É–ø–æ–≤
                        <br><br>
                        3. <strong>–†–µ–∂–∏–º —Ñ–æ–∫—É—Å–∞:</strong> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–§–æ–∫—É—Å" –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                        <br><br>
                        4. <strong>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:</strong> –ù–∞–∂–º–∏—Ç–µ "–í—ã–ø–æ–ª–Ω–∏—Ç—å" —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ
                        <br><br>
                        5. <strong>–¢–µ—Å—Ç—ã:</strong> –†–µ—à–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º, –µ—Å–ª–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã
                        <br><br>
                        6. <strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–µ—Ç–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ.
                        <br><br>
                        7. <strong>–ü–æ–¥—Å–∫–∞–∑–∫–∏:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Å–∫–∞–∑–∫–∞" –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏
                        <br><br>
                        8. <strong>–ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥:</strong> –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥)
                        <br><br>
                        9. <strong>–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å:</strong> –í—ã–ø–æ–ª–Ω–µ–Ω–æ ${completedCount} –∏–∑ ${totalCount} –∑–∞–¥–∞–Ω–∏–π (${percent}%)
                        <br><br>
                        <em>–°–æ–≤–µ—Ç:</em> –î–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ñ–æ–∫—É—Å–∞ –Ω–∞–∂–º–∏—Ç–µ –∫—Ä–µ—Å—Ç–∏–∫ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –∏–ª–∏ –∫–ª–∞–≤–∏—à—É Escape.
                    </div>
                `;
                
                if (isFocus) {
                    const closeBtn = document.createElement('button');
                    closeBtn.className = 'close-btn';
                    closeBtn.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
                    closeBtn.onclick = () => {
                        outputElement.style.display = 'none';
                        this.toggleFocusMode();
                    };
                    outputElement.appendChild(closeBtn);
                    outputElement.style.display = 'block';
                    outputElement.scrollTop = outputElement.scrollHeight;
                } else {
                    outputElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            },
            
            showError(message, error = null) {
                const loadingOverlay = document.getElementById('loadingOverlay');
                loadingOverlay.innerHTML = `
                    <div class="error-message">
                        <h3>${message}</h3>
                        ${error ? `<p>${error.message}</p>` : ''}
                        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ questions.js</p>
                        <button class="retry-btn" id="retryBtn">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É</button>
                    </div>
                `;
                
                document.getElementById('retryBtn').addEventListener('click', () => {
                    window.location.reload();
                });
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            AppState.init();
        });
    </script>
</body>
</html>